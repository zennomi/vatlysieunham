extends ../layouts/common.pug
mixin card-rating(rating, text_header)
    if rating >= 8
        .card.border-success.text-success
            h6.card-header.bg-success.text-white= text_header
            block
    else if rating >= 6
        .card.border-info.text-info
            h6.card-header.bg-info.text-white= text_header
            block
    else if rating >= 4
        .card.border-warning.text-warning
            h6.card-header.bg-warning.text-white= text_header
            block
    else if rating >= 0
        .card.border-danger.text-danger
            h6.card-header.bg-danger.text-white= text_header
            block
    else
        .card
            h6.card-header= text_header
            block
mixin tr-rating(rating)
    if rating >= 8
        tr.table-success
            block
    else if rating >= 6
        tr.table-info    
            block
    else if rating >= 4
        tr.table-warning    
            block
    else if rating >= 0
        tr.table-danger
            block
    else
        tr
            block
block header
    title [#{record.type}] #{record.name}
block content
    h3 Thông tin chi tiết bài tập
    .row.row-cols-2.row-cols-md-6.text-center
        .col-12.col-md-4.mb-2
            .card.border-info
                h6.card-header.bg-info.text-white Thông tin bài tập
                .card-body= record.name
                    span.ml-1.badge.badge-info= record.type
        .col.mb-2
            .card
                h6.card-header Lớp
                .card-body
                    a(href="/classes/"+record.class.name)= record.class.name
        .col.mb-2
            .card
                h6.card-header Thời gian
                .card-body= record.getDetailedDate()
        .col.mb-2
            +card-rating(record.getAverageMark()/record.total*10, 'Tổng số')
                .card-body= `${record.total} - TB ${Math.round(record.getAverageMark()*100)/100}`
        .col.mb-2
            +card-rating(record.getNumberOfFilledStudent()/record.student.length*10, 'Tỷ lệ')
                .card-body= record.getNumberOfFilledStudent() + '/' + record.student.length
        if record.note
            .col-12.col-md-4.mb-2
                .card
                    h6.card-header Ghi chú
                    .card-body= record.note

    .input-group.mb-3
        .input-group-prepend
            span#basic-addon1.input-group-text Lọc
        input.form-control#student-filter(type='text', placeholder='Tên, ID,...', aria-label='Username', aria-describedby='basic-addon1')
    .row.row-cols-3#navbar-bottom
        .col
            a.btn.btn-success.w-100(href='/records/edit/'+record._id) Cập nhật
        .col
            a.btn.btn-danger.w-100(href='/records/delete/'+record._id) Xóa
        .col
            button.btn.btn-light.w-100(onclick="window.history.back()") Quay lại

    table.table.table-hover.table-light#student-table.mt-2
        thead
            tr
                th.text-center ID
                    svg.ml-1.bi.bi-arrow-down-up(width='1em', height='1em', viewbox='0 0 16 16', fill='currentColor', xmlns='http://www.w3.org/2000/svg')
                        path(fill-rule='evenodd', d='M11.5 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L11 2.707V14.5a.5.5 0 0 0 .5.5zm-7-14a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L4 13.293V1.5a.5.5 0 0 1 .5-.5z')
                th Tên
                    svg.ml-1.bi.bi-arrow-down-up(width='1em', height='1em', viewbox='0 0 16 16', fill='currentColor', xmlns='http://www.w3.org/2000/svg')
                        path(fill-rule='evenodd', d='M11.5 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L11 2.707V14.5a.5.5 0 0 0 .5.5zm-7-14a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L4 13.293V1.5a.5.5 0 0 1 .5-.5z')
                th.text-center Điểm
                    svg.ml-1.bi.bi-arrow-down-up(width='1em', height='1em', viewbox='0 0 16 16', fill='currentColor', xmlns='http://www.w3.org/2000/svg')
                        path(fill-rule='evenodd', d='M11.5 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L11 2.707V14.5a.5.5 0 0 0 .5.5zm-7-14a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L4 13.293V1.5a.5.5 0 0 1 .5-.5z')
                th.d-none.d-sm-block Ghi chú
        tbody
            each student in record.student
                +tr-rating(student.finish_count/record.total*10)
                    td.text-center= student.student_id.id
                    td
                        a.text-dark(href='/students/'+student.student_id.id)= student.student_id.name
                    td.text-center= (student.finish_count != undefined) ? Math.round(student.finish_count/record.total*100)/10 : ''
                    td.d-none.d-sm-block= student.note
block script
    script(type='text/javascript', src='/student.filter.js')